<!DOCTYPE html>
{% load static %}
{% load mptt_tags %}
{% load notifications_tags %}
<html lang="en">
  
<!-- Mirrored from themashabrand.com/templates/Fluffs/photo_single_post.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 09 Oct 2020 21:12:19 GMT -->
<head>
<style>
.comment_form.body:focus {
  box-shadow: none;
}
h1 {
    font-family: 'Abhaya Libre', serif;
    font-size: 14px;
    color: #88898a !important;
</style>
	    <!-- ==============================================
		Title and Meta Tags
		=============================================== -->
		<meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">  
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>GrabPub - Post Detail View</title>
		<meta name="description" content="" />
        <meta name="keywords" content="" />
        <meta property="og:title" content="" />
        <meta property="og:url" content="" />
        <meta property="og:description" content="" />		
		
		<!-- ==============================================
		Favicons
		=============================================== --> 
		<link rel="icon" href="{% static 'assets/img/logo.html'%}">
		<link rel="apple-touch-icon" href="{% static 'img/favicons/apple-touch-icon.html'%}">
		<link rel="apple-touch-icon" sizes="72x72" href="{% static 'img/favicons/apple-touch-icon-72x72.html'%}">
		<link rel="apple-touch-icon" sizes="114x114" href="{% static 'img/favicons/apple-touch-icon-114x114.html'%}">
		
	    <!-- ==============================================
		CSS
		=============================================== -->
        <link type="text/css" href="{% static 'assets/css/demos/photo.css'%}" rel="stylesheet" />
				
		<!-- ==============================================
		Feauture Detection
		=============================================== -->
		<script src="{% static 'assets/js/modernizr-custom.html'%}"></script>

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->	
		
  </head>

<body>

 <!-- ==============================================
     Navigation Section
     =============================================== -->  
     <header class="tr-header">
      <nav class="navbar navbar-default">
       <div class="container-fluid">
	    <div class="navbar-header">
		 <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
		  <span class="sr-only">Toggle navigation</span>
		  <span class="icon-bar"></span>
		  <span class="icon-bar"></span>
		  <span class="icon-bar"></span>
		 </button>
		 <a class="navbar-brand" href="{%url 'profiles:follow-feed'%}"><i class="fab fa-instagram"></i> GrabPub</a>
		</div><!-- /.navbar-header -->
		<div class="navbar-left">
		 <div class="collapse navbar-collapse" id="navbar-collapse">
		  <ul class="nav navbar-nav">
		  </ul>
		 </div>
		</div><!-- /.navbar-left -->
		<div class="navbar-right">                          
		 <ul class="nav navbar-nav">
		   <li>
		   <div class="search-dashboard">
               <form>
                    <input placeholder="Search here" type="text">
                    <button type="submit"><i class="fa fa-search"></i></button>
               </form>
          </div>							
		   </li>
           {% comment %} notification area  {% endcomment %}


{% notifications_unread as unread_count %}
		   <li class="dropdown notification-list">
		    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="{% url 'notify:ni' %}" role="button" aria-haspopup="false" aria-expanded="false">
			 <i class="fa fa-bell noti-icon"></i>
			 {% if unread_count > 0 %}<span class="badge badge-danger badge-pill noti-icon-badge">{{ unread_count }}</span>{% endif %}
			</a>
			<div class="dropdown-menu dropdown-menu-right dropdown-lg">
             
			 <div class="dropdown-item noti-title">
			  <h6 class="m-0">
			   <span class="pull-right">
			    <a href="" class="text-dark"><small>Clear All</small></a> 
			   </span>Notification
			  </h6>
			 </div>

			 <div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 416.983px;">
			  <div class="slimscroll" style="max-height: 230px; overflow: hidden; width: auto; height: 416.983px;">
			   <div id="Slim">
               {% if not notify %}
               <h3 style="font-family: 'Abhaya Libre', serif;margin-top:40px;text-align:center;">Empty</h3>
               {% else %}
               {% for note in notify %}
               
			    <a href="javascript:void(0);" class="dropdown-item notify-item">
				 <div class="notify-icon bg-success"><img src="{{note.actor.userprofile.avatar.url}}" alt="" style="height:42px;width:42px;border-radius:50%;margin-top:-3px"></div>
				 <p class="notify-details">{{note.actor}} {{note.verb}}<small class="text-muted">{{note.timestamp|timesince}}</small></p>
				</a><!--/ dropdown-item-->
                {% endfor %}
                {% endif %}
			   </div><!--/ .Slim-->
			   <div class="slimScrollBar" style="background: rgb(158, 165, 171) none repeat scroll 0% 0%; width: 8px; position: absolute; top: 0px; opacity: 0.4; display: block; border-radius: 7px; z-index: 99; right: 1px;"></div>
			   <div class="slimScrollRail" style="width: 8px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; background: rgb(51, 51, 51) none repeat scroll 0% 0%; opacity: 0.2; z-index: 90; right: 1px;"></div>
			  </div><!--/ .slimscroll-->
			 </div><!--/ .slimScrollDiv-->
			 <a href="{% url 'notify:ni' %}" class="dropdown-item text-center notify-all">
			  View all <i class="fa fa-arrow-right"></i>
			 </a><!-- All-->
            </div><!--/ dropdown-menu-->
		   </li>

		  
		  
		 <li class="dropdown mega-avatar">
		   <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
		   <span class="avatar w-32"><img src="{{request.user.userprofile.avatar.url}}" class="img-resonsive img-circle" width="25" height="25" alt="..."></span>
		   <!-- hidden-xs hides the username on small devices so only the image appears. -->
		   <span class="hidden-xs">
			{{user.username}}
		   </span>
		  </a>
		  <div class="dropdown-menu w dropdown-menu-scale pull-right">
		   <a class="dropdown-item" href="#"><span>New Story</span></a> 
		   <a class="dropdown-item" href="#"><span>Become a Member</span></a> 
		   <div class="dropdown-divider"></div>
		   <a class="dropdown-item" href="{% url 'profiles:detail' username=request.user %}"><span>Profile</span></a> 
		   <a class="dropdown-item" href="#"><span>Settings</span></a> 
		   <a class="dropdown-item" href="#">Need help?</a> 
		   <div class="dropdown-divider"></div>
		   <a class="dropdown-item" href="{% url 'accounts:logout' %}">Sign out</a>
		  </div>
		 </li><!-- /navbar-item -->	
		 
		 </ul><!-- /.sign-in -->   
		</div><!-- /.nav-right -->
       </div><!-- /.container -->
      </nav><!-- /.navbar -->
     </header><!-- Page Header --> 
  
	 <!-- ==============================================
	 Navbar Second Section
	 =============================================== -->
	<section class="nav-sec">
	  <div class="d-flex justify-content-between">
	   <div class="p-2 nav-icon-lg mint-green">
	   <a class="nav-icon" href="{% url 'profiles:follow-feed'%}"><em class="fa fa-home"></em>
		<span>Home</span>
	   </a>
	   </div>
	   <div class="p-2 nav-icon-lg clean-black">
	   <a class="nav-icon" href="{% url 'posts:post_list'%}"><em class="fa fa-crosshairs"></em>
		<span>Explore</span>
	   </a>
	   </div>
	   <div class="p-2 nav-icon-lg dark-black">
	   <a class="nav-icon" href="photo_upload.html"><em class="fab fa-instagram"></em>
		<span>Upload</span>
	   </a>
	   </div>
	   <div class="p-2 nav-icon-lg clean-black">
	   <a class="nav-icon" href="{% url 'tags:all' %}"><em class="fa fa-align-left"></em>
		<span>Stories</span>
	   </a>
	   </div>
	   <div class="p-2 nav-icon-lg dark-black">
	   <a class="nav-icon" href="{% url 'profiles:detail' username=request.user %}"><em class="fa fa-user"></em>
		<span>Profile</span>
	   </a>
	   </div>
	  </div>
	</section>	
  
	 <!-- ==============================================
	 Modal Section
	 =============================================== -->
     <section class="single-post">
	 
	   <div class="row">
	 
      <div class="modal-dialog">
       <div class="modal-content">
        <div class="modal-body">
		
         <div class="row">
          <div class="col-md-8 modal-image">
           <img class="img-responsive" src="{{post.image_data.url}}" alt="Image"/>
           <h5>{{post.title|safe}}</h5>
          </div><!--/ col-md-8 -->
          <div class="col-md-4 modal-meta">
           <div class="modal-meta-top">
            
            
            <div class="img-poster clearfix" id="post_id" post-id="{{post.pk}}" post-slug="{{post.slug}}">
             <span>By-</span><a href="{% url 'profiles:detail' username=post.username %}"><img class="img-responsive img-circle" src="{{post.username.avatar.url}}" alt="Image"/></a>
             <strong><a href="{% url 'profiles:detail' username=post.username %}">{{post.username}}</a></strong>
             <span>{{object.create_date|timesince}}</span><br/>
		     <a href="#" class="kafe kafe-btn-mint-small"><i class="fa fa-check-square"></i> Following</a>
            </div><!--/ img-poster -->
			  
            <ul class="img-comment-list">
            {% recursetree allcomments %}
             <li id="{{node.id}}">
              <div class="comment-img">
               <img src="{{node.author.userprofile.avatar.url}}" class="img-responsive img-circle" alt="Image"/>
              </div>
              <div class="comment-text">
               <strong><a href="#">{{node.author}}</a></strong>
               <p>{{node.body|linebreaks}}</p> <span class="date sub-text">{{node.create_date|timesince}}</span>
               {% comment %} reply section {% endcomment %}
                {% if node.level < 1 %} 
                <button class='btn btn-link' style="padding:0;border: none;border-radius: 0; background-color: trasparent;color:black" onclick="myFunction({{node.id}})" title="Reply this comment" ><i class="fa fa-reply" aria-hidden="true"></i></button>
                {% endif %}
                {% comment %} delete section  {% endcomment %}
                 {% if node.author|stringformat:"s" == user.get_username  %}
                <button class="btn btn-link" style=" padding:0;border: none;border-radius: 0; background-color: trasparent;" onclick="deleteComment({{ node.id }})" title="delete this comment" aria-label="Delete"><span class="hover-only-label" style="color:red;">Delete</span></button>
                {% endif %}
              </div>
              </li><!--/ li -->
              {% if not node.is_leaf_node %}
                <ul>
                    {{children}}
                </ul>
              {% endif %}
             {% endrecursetree %}
            </ul><!--/ comment-list -->
			 
         
            <div class="modal-meta-bottom">
			 <ul>
			  <li><button class="btn btn-link text-dark p-0 border-0 btn-outline-light" id="like-button" value="{{post.id}}">{% csrf_token %}
                    <i class="fa fa-heart"></i><span class="" id="like_count">{{post.likes.count}}</span>
                    </button> | 
			      <span><i class="fa fa-comments"></i></span><span> {{post.comments.count}}</span> </li>
			  <li>
             <form id='commentform' class='commentform' method='POST'>  
               {% csrf_token %} 
              <select name='post' class='d-none hidden' id='id_post'>
                <option value="{{ post.id }}" selected="{{ post.id }}"></option>
              </select>
              <label class='small font-weight-bold'>{{comment_form.parent.label}}</label>
			   <span class="thumb-xs">
				<img  id='avatar_comment' class="img-responsive img-circle avatar_comment" src="{{request.user.userprofile.avatar.url}}" alt="Image">
			   </span>
			   <div class="comment-body">
				 {{comment_form.body }}
                 <button type='submit' class='newcomment btn btn-primary hidden' value='commentform' id='newcomment'><i class="fas fa-paper-plane"></i></button>
			   </div><!--/ comment-body -->
               </form>		
              </li>				
             </ul>
            </div><!--/ modal-meta-bottom -->
           </div><!--/ modal-meta-top -->
          </div><!--/ col-md-4 -->
		  
         </div><!--/ row -->
        </div><!--/ modal-body -->
		
       </div><!--/ modal-content -->
      </div><!--/ modal-dialog -->
	  
      </div><!--/ modal-dialog -->
      </div><!--/ modal-dialog -->
     </section><!--/ modal -->	 
	   
     <!-- ==============================================
	 Scripts
	 =============================================== -->
	<script src="{% static 'assets/js/jquery.min.js'%}"></script>
	<script src="{% static 'assets/js/bootstrap.min.js'%}"></script>
	<script src="{% static 'assets/js/base.js'%}"></script>
	<script src="{% static 'assets/plugins/slimscroll/jquery.slimscroll.js'%}"></script>
	<script>
	$('#Slim,#Slim2').slimScroll({
	        height:"auto",
			position: 'right',
			railVisible: true,
			alwaysVisible: true,
			size:"8px",
		});		
	</script>


    <script>
  //Comments
  
  $(document).on('click', '#newcomment, #newcommentinner', function (e) {
    e.preventDefault();

    var button = $(this).attr("value");
    var post_id =$('#post_id').attr('post-id');
    var post_slug = $('#post_id').attr('post-slug');
    console.log(post_id,'postid')
    var placement = "commentform"
    if (button == "newcommentform") {
      var placement = "newcommentform"
    }
    
    var imgFullURL= $('#avatar_comment').attr('src');
    $.ajax({
      type: 'POST',
      url: '{% url "posts:addcomment" %}',
      data: $("#" + button).serialize() + "&post_id="+post_id + "&post_slug="+post_slug,
      cache: false,
      error: console.log('post_id' + post_id),
      success: function (json) {
        console.log(json)

        $('<div class="comment-img"> \
                <img  style="height:22px;width:22px;" src="'+ imgFullURL + '" class="img-responsive img-circle" alt="Image"> \
            </div> \
            <div class="comment-text"> \
                <strong><p>' + json['user'] + '</p></strong> \
                <p></p><p>' + json['result2'] + '</p><p></p> <span class="date sub-text">Just now</span> \
            </div> \
        ').insertBefore('#' + placement);

        $('.commentform').trigger("reset");
        formExit()
      },
      error: function (xhr, errmsg, err) {
      }
    });
  })

function formExit() {
    document.getElementById("newcommentform").remove();
  }

function myFunction(id) {
    if (document.contains(document.getElementById("newcommentform"))) {
      document.getElementById("newcommentform").remove();
    }
    var post_id =$('#post_id').attr('post-id');
    var imgFullURL= $('#avatar_comment').attr('src');
    var d1 = document.getElementById(id);
    d1.insertAdjacentHTML('afterend',
      '<form id="newcommentform" class="commentform" method="post"> \
        {% csrf_token %} \
        <select name="post" class="d-none hidden" id="id_post"> \
          <option value="' + post_id +'" selected="' + post_id + '"></option> \
        </select> <label class="small font-weight-bold"></label> \
        <select name="parent" class="d-none hidden" id="id_parent"> \
          <option value="' + id + '" selected="' + id + '"></option> \
        </select> \
         <div class="d-flex"> \
          <img id="avatar_comment" class="avatar_comment img-responsive img-circle"" src="' + imgFullURL + '"> \
          <textarea style="margin-left:4px;" name="body" cols="40" rows="1" class="ml-3 mb-3 form-control border-0 comment-add rounded-0" placeholder="Add a public comment" required="" id="id_content"></textarea> \
        </div> \
        <div class="d-flex flex-row-reverse" style="margin-left:10px;"> \
        <button type="button" class="btn btn-link" onclick="formExit()">Close</button> \
        <button type="submit" class="newcomment btn btn-link" value="newcommentform" id="newcommentinner"><i class="fas fa-paper-plane"></i></button>\
        </div> \
      </form>'
    );
  }

function formExit() {
    document.getElementById("newcommentform").remove();
  }

function deleteComment(id) {
    var post_id =$('#post_id').attr('post-id');
    var post_slug = $('#post_id').attr('post-slug');
    console.log(id)
    $.ajax({
      type: 'POST',
      url: '{% url "posts:addcomment" %}',
      data: {
        nodeid: id,
        post_id:post_id,
        post_slug:post_slug,
        action: 'delete',
        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
      },
      success: function (json) {
        $("#" + json['remove']).remove();
      },
      error: function (xhr, errmsg, err) {}
    });
  }

  $('#myForm').trigger("reset");
</script>


{% comment %} For like toggling {% endcomment %}
<script>


  $(document).on('click', '#like-button', function (e) {
    e.preventDefault();
    $.ajax({
      type: 'POST',
      url: '{% url "posts:like" %}',
      data: {
        postid: $('#like-button').val(),
        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
        action: 'post'
      },
      success: function (json) {
        document.getElementById("like_count").innerHTML = json['result']
      },
      error: function (xhr, errmsg, err) {
      }
    });
  })
</script>


  </body>

<!-- Mirrored from themashabrand.com/templates/Fluffs/photo_single_post.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 09 Oct 2020 21:12:19 GMT -->
</html>

   